generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =============================================
// LOCATION INTELLIGENCE (1000+ attributes)
// =============================================

model Location {
  id                     String    @id @default(uuid()) @db.VarChar(36)
  latitude               Decimal   @db.Decimal(10, 7)
  longitude              Decimal   @db.Decimal(10, 7)
  geoHash                String?   @map("geo_hash") @db.VarChar(20)
  wardName               String?   @map("ward_name") @db.VarChar(100)
  wardNumber             String?   @map("ward_number") @db.VarChar(20)
  assemblyConstituency   String?   @map("assembly_constituency") @db.VarChar(100)
  parliamentaryConstituency String? @map("parliamentary_constituency") @db.VarChar(100)
  city                   String    @db.VarChar(100)
  microMarket            String?   @map("micro_market") @db.VarChar(150)
  subMicroMarket         String?   @map("sub_micro_market") @db.VarChar(150)
  pinCode                String?   @map("pin_code") @db.VarChar(10)
  bbmpZone               String?   @map("bbmp_zone") @db.VarChar(100)
  policeStation          String?   @map("police_station") @db.VarChar(100)
  roadName               String?   @map("road_name") @db.VarChar(255)
  roadWidthMeters        Decimal?  @map("road_width_meters") @db.Decimal(6, 2)
  roadType               String?   @map("road_type") @db.VarChar(50)
  zoningClassification   String?   @map("zoning_classification") @db.VarChar(100)
  attributesJson         Json?     @map("attributes_json") @default("{}")
  createdAt              DateTime? @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt              DateTime? @map("updated_at") @default(now()) @db.Timestamp(6)

  demographics           LocationDemographics?
  commercial             LocationCommercial?
  mobility               LocationMobility?
  realEstate             LocationRealEstate?
  scores                 LocationScores[]

  @@map("locations")
}

model LocationDemographics {
  id                String   @id @default(uuid()) @db.VarChar(36)
  locationId        String   @unique @map("location_id") @db.VarChar(36)
  population100m    Int?     @map("population_100m")
  population250m    Int?     @map("population_250m")
  population500m    Int?     @map("population_500m")
  population1km     Int?     @map("population_1km")
  population3km     Int?     @map("population_3km")
  populationDensity500m Decimal? @map("population_density_500m") @db.Decimal(12, 2)
  householdCount500m Int?    @map("household_count_500m")
  attributesJson    Json?    @map("attributes_json") @default("{}")
  version           Int?     @default(1)
  lastUpdated       DateTime? @map("last_updated") @default(now()) @db.Timestamp(6)
  createdAt         DateTime? @map("created_at") @default(now()) @db.Timestamp(6)

  location          Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@map("location_demographics")
}

model LocationCommercial {
  id                    String   @id @default(uuid()) @db.VarChar(36)
  locationId            String   @unique @map("location_id") @db.VarChar(36)
  competitorBrandPresence Json?  @map("competitor_brand_presence") @default("{}")
  saturationIndices     Json?    @map("saturation_indices") @default("{}")
  attributesJson        Json?    @map("attributes_json") @default("{}")
  version               Int?     @default(1)
  lastUpdated           DateTime? @map("last_updated") @default(now()) @db.Timestamp(6)
  createdAt             DateTime? @map("created_at") @default(now()) @db.Timestamp(6)

  location              Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@map("location_commercial")
}

model LocationMobility {
  id               String   @id @default(uuid()) @db.VarChar(36)
  locationId       String   @unique @map("location_id") @db.VarChar(36)
  avgDailyFootfall Int?     @map("avg_daily_footfall")
  weekdayFootfall  Int?     @map("weekday_footfall")
  weekendFootfall  Int?     @map("weekend_footfall")
  peakHourFootfall Int?     @map("peak_hour_footfall")
  dwellTimeAvg     Int?     @map("dwell_time_avg")
  attributesJson   Json?    @map("attributes_json") @default("{}")
  version          Int?     @default(1)
  lastUpdated      DateTime? @map("last_updated") @default(now()) @db.Timestamp(6)
  createdAt        DateTime? @map("created_at") @default(now()) @db.Timestamp(6)

  location         Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@map("location_mobility")
}

model LocationRealEstate {
  id                 String   @id @default(uuid()) @db.VarChar(36)
  locationId         String   @unique @map("location_id") @db.VarChar(36)
  rentPerSqft        Decimal? @map("rent_per_sqft") @db.Decimal(10, 2)
  frontageWidth      Decimal? @map("frontage_width") @db.Decimal(8, 2)
  ceilingHeight      Decimal? @map("ceiling_height") @db.Decimal(5, 2)
  powerLoadCapacity  String?  @map("power_load_capacity") @db.VarChar(50)
  attributesJson     Json?    @map("attributes_json") @default("{}")
  version            Int?     @default(1)
  lastUpdated        DateTime? @map("last_updated") @default(now()) @db.Timestamp(6)
  createdAt          DateTime? @map("created_at") @default(now()) @db.Timestamp(6)

  location           Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@map("location_real_estate")
}

model LocationScores {
  id                  String   @id @default(uuid()) @db.VarChar(36)
  locationId          String   @map("location_id") @db.VarChar(36)
  cafeFitScore        Decimal? @map("cafe_fit_score") @db.Decimal(5, 2)
  qsrFitScore         Decimal? @map("qsr_fit_score") @db.Decimal(5, 2)
  luxuryFitScore      Decimal? @map("luxury_fit_score") @db.Decimal(5, 2)
  revenueProjectionMid Decimal? @map("revenue_projection_mid") @db.Decimal(15, 2)
  roi3yr              Decimal? @map("roi_3yr") @db.Decimal(8, 2)
  whitespaceScore     Decimal? @map("whitespace_score") @db.Decimal(5, 2)
  demandGapScore      Decimal? @map("demand_gap_score") @db.Decimal(5, 2)
  scoresJson          Json?    @map("scores_json") @default("{}")
  explanationText     String?  @map("explanation_text") @db.Text
  version             Int?     @default(1)
  lastUpdated         DateTime? @map("last_updated") @default(now()) @db.Timestamp(6)
  createdAt           DateTime? @map("created_at") @default(now()) @db.Timestamp(6)

  location            Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@map("location_scores")
}

model brand_profiles {
  id                         String    @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  user_id                    String    @unique @db.VarChar(36)
  company_name               String    @db.VarChar(255)
  industry                   String?   @db.VarChar(100)
  category                   String?   @db.VarChar(50)
  avg_ticket_size            Decimal?  @map("avg_ticket_size") @db.Decimal(10, 2)
  preferred_income_bracket   String?   @map("preferred_income_bracket") @db.VarChar(20)
  ideal_footfall_min         Int?      @map("ideal_footfall_min")
  max_saturation_tolerance Decimal?  @map("max_saturation_tolerance") @db.Decimal(5, 2)
  weight_config_json         Json?     @map("weight_config_json")
  preferred_locations        Json?
  budget_min                 Decimal?  @db.Decimal(15, 2)
  budget_max                 Decimal?  @db.Decimal(15, 2)
  min_size                   Int?
  max_size                   Int?
  preferred_property_types   Json?
  must_have_amenities      Json?
  created_at                 DateTime? @default(now()) @db.Timestamp(6)
  updated_at                 DateTime? @default(now()) @db.Timestamp(6)
  user                       User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_brand_profiles_user_id")
}

model Inquiry {
  id                              String               @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  propertyId                      String               @map("property_id") @db.VarChar(36)
  brandId                         String               @map("brand_id") @db.VarChar(36)
  ownerId                         String?               @map("owner_id") @db.VarChar(36)
  message                         String
  status                          inquiry_status_enum? @default(pending)
  createdAt                       DateTime?            @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt                       DateTime?            @map("updated_at") @default(now()) @db.Timestamp(6)
  brand                           User                 @relation("inquiries_brand_idTousers", fields: [brandId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  owner                           User?                @relation("inquiries_owner_idTousers", fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  property                        Property             @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  responses                       inquiry_responses[]

  @@map("inquiries")
  @@index([brandId], map: "idx_inquiries_brand_id")
  @@index([ownerId], map: "idx_inquiries_owner_id")
  @@index([propertyId], map: "idx_inquiries_property_id")
  @@index([status], map: "idx_inquiries_status")
}

model inquiry_responses {
  id         String    @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  inquiry_id String    @db.VarChar(36)
  sender_id  String    @db.VarChar(36)
  message    String
  created_at DateTime? @default(now()) @db.Timestamp(6)
  inquiry    Inquiry   @relation(fields: [inquiry_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sender     User      @relation(fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([inquiry_id], map: "idx_inquiry_responses_inquiry_id")
}

model location_reports {
  id          String              @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  user_id     String              @db.VarChar(36)
  location    String              @db.VarChar(500)
  category    String?             @db.VarChar(100)
  report_data Json?
  is_free     Boolean?            @default(false)
  payment_id  String?             @db.VarChar(100)
  amount      Decimal?            @db.Decimal(10, 2)
  status      report_status_enum? @default(pending)
  created_at  DateTime?           @default(now()) @db.Timestamp(6)
  expires_at  DateTime?           @db.Timestamp(6)
  user        User                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([status], map: "idx_location_reports_status")
  @@index([user_id], map: "idx_location_reports_user_id")
}

model owner_profiles {
  id               String    @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  user_id          String    @unique @db.VarChar(36)
  company_name     String?   @db.VarChar(255)
  license_number   String?   @db.VarChar(100)
  total_properties Int?      @default(0)
  created_at       DateTime? @default(now()) @db.Timestamp(6)
  updated_at       DateTime? @default(now()) @db.Timestamp(6)
  user             User      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_owner_profiles_user_id")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model Property {
  id                   String             @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  title                String             @db.VarChar(255)
  description          String?
  address              String             @db.VarChar(500)
  city                 String             @db.VarChar(100)
  state                String             @db.VarChar(100)
  zipCode              String             @map("zip_code") @db.VarChar(20)
  price                Decimal            @db.Decimal(15, 2)
  priceType            price_type_enum    @map("price_type") @default(monthly)
  securityDeposit      Decimal?           @map("security_deposit") @db.Decimal(15, 2)
  rentEscalation       Decimal?           @map("rent_escalation") @db.Decimal(5, 2)
  size                 Int
  propertyType         property_type_enum @map("property_type")
  // mapLink temporarily stored in amenities JSONB field due to Supabase column creation timeout
  // mapLink              String?            @map("map_link") @db.VarChar(1000)
  storePowerCapacity   String?            @map("store_power_capacity") @db.VarChar(50)
  powerBackup          Boolean?           @map("power_backup") @default(false)
  waterFacility        Boolean?           @map("water_facility") @default(false)
  amenities            Json?
  images               Json?
  ownerId              String             @map("owner_id") @db.VarChar(36)
  status                property_status_enum @default(pending)
  availability         Boolean?           @map("is_available") @default(true)
  isFeatured           Boolean?           @map("is_featured") @default(false)
  views                Int?               @map("views_count") @default(0)
  displayOrder         Int?               @map("display_order")
  createdAt            DateTime?          @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt            DateTime?          @map("updated_at") @default(now()) @db.Timestamp(6)
  inquiries            Inquiry[]
  owner                User               @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  propertyViews        property_views[]
  savedBy              SavedProperty[]
  expertRequests       ExpertRequest[]

  @@map("properties")
  @@index([city], map: "idx_properties_city")
  @@index([availability], map: "idx_properties_is_available")
  @@index([ownerId], map: "idx_properties_owner_id")
  @@index([price], map: "idx_properties_price")
  @@index([propertyType], map: "idx_properties_property_type")
  @@index([size], map: "idx_properties_size")
  @@index([status], map: "idx_properties_status")
}

model property_views {
  id          String     @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  property_id String     @db.VarChar(36)
  user_id     String?    @db.VarChar(36)
  ip_address  String?    @db.VarChar(45)
  user_agent  String?
  viewed_at   DateTime?  @default(now()) @db.Timestamp(6)
  property    Property   @relation(fields: [property_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        User?      @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([property_id], map: "idx_property_views_property_id")
  @@index([viewed_at], map: "idx_property_views_viewed_at")
}

model SavedProperty {
  id          String     @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  userId      String     @map("user_id") @db.VarChar(36)
  propertyId  String     @map("property_id") @db.VarChar(36)
  notes       String?     @db.Text
  createdAt   DateTime?   @map("created_at") @default(now()) @db.Timestamp(6)
  property    Property    @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("saved_properties")
  @@unique([userId, propertyId])
  @@index([userId], map: "idx_saved_properties_user_id")
}

model User {
  id                                  String              @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  email                               String              @unique @db.VarChar(255)
  password                            String              @map("password_hash") @db.VarChar(255)
  name                                String              @db.VarChar(255)
  phone                               String?             @db.VarChar(20)
  userType                            user_type_enum      @map("user_type")
  displayOrder                        Int?                @map("display_order")
  createdAt                           DateTime?           @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt                           DateTime?           @map("updated_at") @default(now()) @db.Timestamp(6)
  isActive                            Boolean?            @map("is_active") @default(true)
  brandProfiles                       brand_profiles?
  inquiriesAsBrand                    Inquiry[]           @relation("inquiries_brand_idTousers")
  inquiriesAsOwner                    Inquiry[]           @relation("inquiries_owner_idTousers")
  inquiryResponses                    inquiry_responses[]
  locationReports                     location_reports[]
  ownerProfiles                       owner_profiles?
  properties                          Property[]
  propertyViews                       property_views[]
  savedProperties                     SavedProperty[]

  @@map("users")
  @@index([email], map: "idx_users_email")
  @@index([userType], map: "idx_users_user_type")
}

enum inquiry_status_enum {
  pending
  responded
  closed
}

enum price_type_enum {
  monthly
  yearly
  sqft
}

enum property_type_enum {
  office
  retail
  warehouse
  restaurant
  other
}

enum report_status_enum {
  pending
  completed
  failed
}

enum user_type_enum {
  brand
  owner
  admin
}

enum property_status_enum {
  pending
  approved
  rejected
}

model ExpertRequest {
  id              String    @id @default(dbgenerated("(gen_random_uuid())::character varying(36)")) @db.VarChar(36)
  propertyId      String    @map("property_id") @db.VarChar(36)
  brandName       String    @map("brand_name") @db.VarChar(255)
  email           String?   @db.VarChar(255)
  phone           String    @db.VarChar(20)
  scheduleDateTime DateTime @map("schedule_date_time") @db.Timestamp(6)
  notes           String    @db.Text
  status          expert_request_status_enum @default(pending)
  createdAt       DateTime? @map("created_at") @default(now()) @db.Timestamp(6)
  updatedAt       DateTime? @map("updated_at") @default(now()) @db.Timestamp(6)
  property        Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@map("expert_requests")
  @@index([propertyId], map: "idx_expert_requests_property_id")
  @@index([status], map: "idx_expert_requests_status")
  @@index([createdAt], map: "idx_expert_requests_created_at")
}

enum expert_request_status_enum {
  pending
  contacted
  scheduled
  completed
  cancelled
}